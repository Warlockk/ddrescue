exec_prefix = $(prefix)
bindir = $(exec_prefix)/bin

DISTNAME = ddrescue-0.9

CXX = g++
INSTALL = install
INSTALL_PROGRAM = $(INSTALL) -p -m 755
INSTALL_DATA = $(INSTALL) -p -m 644
SHELL = /bin/sh
CPPFLAGS =
CXXFLAGS = -Wall -W -O2
LDFLAGS =

objs = ddrescue.o

.PHONY : all doc install install-info install-man install-strip \
         uninstall uninstall-info uninstall-man \
         dist clean distclean

all : ddrescue

ddrescue : $(objs)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -o ddrescue $(objs)

ddrescuep : $(objs)
	$(CXX) $(LDFLAGS) $(CXXFLAGS) -pg -o ddrescuep $(objs)

%.o : %.cc
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

doc : $(VPATH)/doc/ddrescue.info $(VPATH)/doc/ddrescue.1

$(VPATH)/doc/ddrescue.info : $(VPATH)/doc/ddrescue.texinfo
	cd $(VPATH)/doc ; makeinfo ddrescue.texinfo

$(VPATH)/doc/ddrescue.1 : ddrescue
	help2man -o $(VPATH)/doc/ddrescue.1 ./ddrescue

Makefile : Makefile.in
	$(VPATH)/configure

install : all install-info
	if test ! -d $(DESTDIR)$(bindir) ; then $(INSTALL) -d $(DESTDIR)$(bindir) ; fi
	$(INSTALL_PROGRAM) ./ddrescue $(DESTDIR)$(bindir)/ddrescue

install-info :
	if test ! -d $(DESTDIR)$(infodir) ; then $(INSTALL) -d $(DESTDIR)$(infodir) ; fi
	$(INSTALL_DATA) $(VPATH)/doc/ddrescue.info $(DESTDIR)$(infodir)/ddrescue.info
	-install-info $(DESTDIR)$(infodir)/ddrescue.info $(DESTDIR)$(infodir)/dir

install-man :
	if test ! -d $(DESTDIR)$(mandir)/man1 ; then $(INSTALL) -d $(DESTDIR)$(mandir)/man1 ; fi
	$(INSTALL_DATA) $(VPATH)/doc/ddrescue.1 $(DESTDIR)$(mandir)/man1/ddrescue.1

install-strip : all
	$(MAKE) INSTALL_PROGRAM='$(INSTALL_PROGRAM) -s' install

uninstall : uninstall-info uninstall-man
	-rm -f $(DESTDIR)$(bindir)/ddrescue

uninstall-info :
	-install-info --remove $(DESTDIR)$(infodir)/ddrescue.info $(DESTDIR)$(infodir)/dir
	-rm -f $(DESTDIR)$(infodir)/ddrescue.info

uninstall-man :
	-rm -f $(DESTDIR)$(mandir)/man1/ddrescue.1

dist :
	ln -sf . $(DISTNAME)
	tar -cvf $(DISTNAME).tar \
	  $(DISTNAME)/AUTHORS \
	  $(DISTNAME)/COPYING \
	  $(DISTNAME)/ChangeLog \
	  $(DISTNAME)/INSTALL \
	  $(DISTNAME)/Makefile.in \
	  $(DISTNAME)/NEWS \
	  $(DISTNAME)/README \
	  $(DISTNAME)/TODO \
	  $(DISTNAME)/configure \
	  $(DISTNAME)/doc/ddrescue.1 \
	  $(DISTNAME)/doc/ddrescue.info \
	  $(DISTNAME)/ddrescue.cc
	rm -f $(DISTNAME)
	bzip2 -v $(DISTNAME).tar

clean :
	-rm -f ddrescue ddrescuep $(objs)

distclean : clean
	-rm -f Makefile *.tar *.bz2
